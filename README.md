# tsv

[![Travis CI Status](https://travis-ci.org/chunglabmit/tsv.svg?branch=master)](https://travis-ci.org/chunglabmit/tsv)


Library to render terastitched volumes

This is a pure Python library that uses the XML output of 
[Terastitcher](https://github.com/abria/TeraStitcher)
to load stitched volumes. Example usage:

```python

import tsv
import numpy as np

volume = tsv.volume.TSVVolume.load(xml_path)
#
# Read from x=0, y=0, z=0 to x=1024, y=1024, z=100
#
img = volume.imread(tsv.volume.VExtent(0, 1024, 0, 1024, 0, 100), np.uint8)

```
## Installation

Installation can be done using PIP, e.g.

```bash
> pip install https://github.com/chunglabmit/tsv/archive/master.zip
```
## Command-line applications

The following applications are available from the command-line
after installing:

**tsv-convert-2D-tif**: convert a terastitcher stitching to 2D .tif files.

This application generates a z-stack of 2D tiff files for either
a portion of or the whole the stitched stack.

**tsv-diag-stack**: create a stack of color images, displaying
each of the stacks in the stitched image using a different color.

This application generates a z-stack of color images. The colors in the
image are the intensities of the stacks that make up the image in the
region (the first 3 of the overlapping images are the ones that are used).
The application can be used to assess the stitching quality - the colors
will colocalize if the stitching quality is good.

Arguments for tsv-convert-2d-tif and tsv-diag-stack:

* **--xml-path**: the path to the XML file generated by terastitcher's
--displproj stage.
* **--output-pattern**: the pattern for output file names. The
pattern follows the syntax for Python's str.format method. A typical
example output pattern is "/data/my-expt/img_{z:04d}.tif" which
will write out files such as "/data/my-expt/img_0000.tif",
"/data/my-expt/img_0001.tif", etc.
* **--mipmap-level**: use this parameter to produce a downsampled
image. A --mipmap-level of 1 will produce images at 1/2 resolution
and will only produce every other z-slice. A --mipmap-level of 2
will produce images at 1/4 resolution and so on. By default,
a full-resolution stack is produced
* **--volume**: the coordinates to be retrieved. These are specified
as six numbers separated by commas for the x start, x end, y start,
y end and z start and z end coordinates. For example, 
"--volume 1000, 2000, 1000, 2000, 40, 60" would produce 
20 1000x1000 images starting at x=1000, y=1000 and z=40. By default,
the full image is written.
* **--compression**: TIFF files are compressed to save disk space,
but higher rates of compression take more time to compress and
decompress. The --compression flag controls the amount of
compression used when writing the TIFF files. --compression=0
uses no compression, --compression=9 uses the maximum compression.
The default is 4 which is a good comprimise between speed and
disk savings.
* **--silent**: disables the progress bar
* **--cpus**: the number of CPUs to use to process the images. The default
is all of the computer's CPUs.

**tsv-renumber-directories**: potentially renumber Smart Spim output directories
so that none have negative offsets.

Arguments:
* **--path**: the path to the root directory.
